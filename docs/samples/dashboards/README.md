# ğŸ“Š MaaS Grafana Dashboards

This directory contains Grafana dashboard samples for the MaaS platform.

## ğŸ“ Dashboard Files

| File | Description |
| ---- | ----------- |
| `platform-admin-dashboard.json` | Unified view for platform administrators |
| `ai-engineer-dashboard.json` | API key-filtered view for AI engineers |
| `maas-token-metrics-dashboard.json` | Legacy token metrics dashboard |

## ğŸ“– Documentation Files

| File | Description |
| ---- | ----------- |
| `METRICS-SUMMARY.md` | **Main reference** - Complete metrics documentation, queries, and limitations |
| `METRICS-EXPORT-FLOW.md` | Architecture flow showing how metrics are exported |
| `PROMETHEUS-COUNTER-BEHAVIOR.md` | Educational guide on Prometheus counter behavior |

## ğŸ¯ Available Metrics

### âœ… All Custom Labels Working!

| Metric | Source | Labels |
| ------ | ------ | ------ |
| `authorized_hits` | Limitador | âœ… `user`, `tier`, `model`, `limitador_namespace` |
| `authorized_calls` | Limitador | âœ… `user`, `tier`, `model`, `limitador_namespace` |
| `limited_calls` | Limitador | âœ… `user`, `tier`, `model`, `limitador_namespace` |
| `limitador_up` | Limitador | Standard |
| `auth_server_response_status_total` | Authorino | `authconfig`, `status` |
| `envoy_http_downstream_rq_xx` | Envoy | `envoy_response_code_class` |

**Verified on cluster:**

```
authorized_hits{model="facebook-opt-125m-simulated",tier="free",user="tgitelma-redhat-com-dd264a84",...} 376
```

See `METRICS-SUMMARY.md` for full details and query examples.

## ğŸ”§ How to Use

1. **Import into Grafana:**
   - Go to Grafana â†’ Dashboards â†’ Import
   - Upload the desired dashboard JSON file
   - Configure Prometheus datasource

2. **Prerequisites:**
   - Prometheus configured to scrape Kuadrant metrics
   - ServiceMonitors deployed for Limitador and Authorino
   - Kuadrant policies configured

## ğŸ“ˆ Working Queries

```promql
# Requests per user
sum by (user) (authorized_hits)

# Requests per model
sum by (model) (authorized_hits)

# Requests per tier
sum by (tier) (authorized_hits)

# Top 10 users
topk(10, sum by (user) (authorized_hits))

# User activity by model
sum by (user, model) (authorized_hits)

# Success rate per user
sum by (user) (authorized_calls) / (sum by (user) (authorized_calls) + sum by (user) (limited_calls))
```

## ğŸ”— Related Files

- **TelemetryPolicy**: `deployment/base/observability/telemetry-policy.yaml`
- **ServiceMonitors**: `deployment/components/observability/prometheus/`

## ğŸ“ Notes

- Dashboards are compatible with Kuadrant v1.3.0+
- âœ… Per-user, per-model, per-tier filtering is fully working
- All custom labels exported by Limitador
- Requires Prometheus Operator for ServiceMonitor support
- Metrics are generated by Limitador with TelemetryPolicy
- Dashboard auto-refreshes every 30 seconds

To customize the dashboard:
1. Import into Grafana
2. Edit panels as needed
3. Export updated JSON
4. Replace this file with your custom version
